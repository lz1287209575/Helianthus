name: 'Notify'
description: 'Send notifications for CI/CD pipeline results'
inputs:
  notification-type:
    description: 'Type of notification to send'
    required: true
    default: 'success'
  message:
    description: 'Custom message to include'
    required: false
    default: ''
  webhook-url:
    description: 'Webhook URL for notifications'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: 'Send success notification'
      shell: bash
      if: inputs.notification-type == 'success'
      run: |
        echo "ğŸ‰ CI/CD Pipeline completed successfully!"
        echo "Build: âœ…"
        echo "Tests: âœ…"
        echo "Code Quality: âœ…"
        echo "Security Scan: âœ…"
        
        if [ -n "${{ inputs.message }}" ]; then
          echo "Custom message: ${{ inputs.message }}"
        fi
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„é€šçŸ¥é€»è¾‘ï¼Œæ¯”å¦‚å‘é€åˆ°Slackã€Discordç­‰
        echo "Success notification sent"

    - name: 'Send failure notification'
      shell: bash
      if: inputs.notification-type == 'failure'
      run: |
        echo "âŒ CI/CD Pipeline failed!"
        echo "Please check the logs for details."
        
        if [ -n "${{ inputs.message }}" ]; then
          echo "Custom message: ${{ inputs.message }}"
        fi
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„é€šçŸ¥é€»è¾‘
        echo "Failure notification sent"

    - name: 'Send warning notification'
      shell: bash
      if: inputs.notification-type == 'warning'
      run: |
        echo "âš ï¸ CI/CD Pipeline completed with warnings!"
        echo "Please review the warnings in the logs."
        
        if [ -n "${{ inputs.message }}" ]; then
          echo "Custom message: ${{ inputs.message }}"
        fi
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„é€šçŸ¥é€»è¾‘
        echo "Warning notification sent"

    - name: 'Send webhook notification'
      shell: bash
      if: inputs.webhook-url != ''
      run: |
        WEBHOOK_URL="${{ inputs.webhook-url }}"
        NOTIFICATION_TYPE="${{ inputs.notification-type }}"
        CUSTOM_MESSAGE="${{ inputs.message }}"
        
        echo "Sending webhook notification to: $WEBHOOK_URL"
        
        # æ„å»ºé€šçŸ¥æ¶ˆæ¯
        if [ "$NOTIFICATION_TYPE" = "success" ]; then
          EMOJI="ğŸ‰"
          COLOR="good"
          TITLE="CI/CD Pipeline Success"
          TEXT="All checks passed successfully!"
        elif [ "$NOTIFICATION_TYPE" = "failure" ]; then
          EMOJI="âŒ"
          COLOR="danger"
          TITLE="CI/CD Pipeline Failure"
          TEXT="Some checks failed. Please review the logs."
        else
          EMOJI="âš ï¸"
          COLOR="warning"
          TITLE="CI/CD Pipeline Warning"
          TEXT="Pipeline completed with warnings."
        fi
        
        # æ·»åŠ è‡ªå®šä¹‰æ¶ˆæ¯
        if [ -n "$CUSTOM_MESSAGE" ]; then
          TEXT="$TEXT\n\n$CUSTOM_MESSAGE"
        fi
        
        # å‘é€webhookï¼ˆè¿™é‡Œä½¿ç”¨curlç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨æ—¶å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“çš„webhookæœåŠ¡è°ƒæ•´ï¼‰
        curl -X POST "$WEBHOOK_URL" \
          -H "Content-Type: application/json" \
          -d "{
            \"text\": \"$EMOJI $TITLE\n$TEXT\",
            \"color\": \"$COLOR\"
          }" || echo "Webhook notification failed"
        
        echo "Webhook notification sent"
